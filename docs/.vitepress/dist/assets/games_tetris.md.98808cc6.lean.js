var Y=Object.defineProperty;var Z=(o,y,D)=>y in o?Y(o,y,{enumerable:!0,configurable:!0,writable:!0,value:D}):o[y]=D;var h=(o,y,D)=>(Z(o,typeof y!="symbol"?y+"":y,D),D);import{_ as K}from"./chunks/lodash.008bc52d.js";import{a as ss}from"./chunks/array.util.cf045339.js";import{g as ns}from"./chunks/number.util.6354c1c0.js";import{S as as}from"./chunks/start-over-mask.df5c4d55.js";import{g as ls,r as b,B as ps,m as os,A as es,_ as rs,o as C,c as A,a as d,d as w,w as j,F as _,h as B,t as G,b as cs,i as V,n as U,p as W,e as $}from"./app.1c3b36fa.js";const q=20,f=10;class ts{constructor(y,D){h(this,"row");h(this,"col");h(this,"status",0);this.row=y,this.col=D}}const Fs=[[[1,1,0],[0,1,1]],[[1,1,1,1]],[[1,1,1],[0,0,1]],[[1,1,1],[1,0,0]],[[1]],[[1,1],[0,1]],[[1,1],[1,0]],[[1,1],[1,1]],[[1,1,1],[0,1,0]]],ys=ls({name:"tetris",components:{StartOverMask:as},props:{},setup(o,y){const D=()=>new Array(q).fill(null).map((s,n)=>new Array(f).fill(null).map((c,l)=>new ts(n,l))),m=b(D()),g=b(0),P=(s,n=1)=>{let c=K.cloneDeep(s),l;for(;n-- >0;){const t=c.length,p=c[0].length;l=[];for(let F=0;F<p;F++){l[F]=[];for(let u=0;u<t;u++)l[F][u]=c[t-u-1][F]}c=K.cloneDeep(l)}return l||c},i=(s,n,c,l=1)=>{for(let t=0;t<s.length;t++)for(let p=0;p<s[0].length;p++){const[F,u]=[t+n,p+c],M=m.value[F][u];M.status!==2&&(M.status=s[t][p]?l:M.status)}},E=s=>Math.floor((f-s[0].length)/2),v=()=>P(ss(Fs,1)[0],ns(0,3)),a=b(0),e=b(0),r=b(null),k=b(null),R=b(0),x=b(0),X=ps(()=>{const s=x.value/20;return Math.floor(1500/(s<1?1:s))});let L=null,O=!0;const S=(s,n,c)=>{for(let l=0;l<s.length;l++)for(let t=0;t<s[0].length;t++){const[p,F]=[l+n,t+c];if(p<0||p>=q||F<0||F>=f||s[l][t]&&m.value[p][F].status===2)return!0}return!1},J=()=>{R.value=0,x.value=0,m.value=D(),r.value=v(),k.value=v(),g.value=2,a.value=-1,e.value=E(r.value),T()},T=()=>{if(clearTimeout(L),g.value===2){if(a.value>=0&&i(r.value,a.value,e.value,0),a.value++,S(r.value,a.value,e.value)){if(i(r.value,a.value-1,e.value,2),a.value<=1)return g.value=3;r.value=k.value,k.value=v(),a.value=0,e.value=E(r.value),H(),O=!1}i(r.value,a.value,e.value,1),L=setTimeout(T,X.value)}},H=()=>{let s=q,n=s,c=0;for(;--s>=0;){const l=m.value[s],t=l.every(p=>p.status===2);if(t&&c++,!(!t&&n>s)){for(n=n>s?s:n;--n>=0;){const p=m.value[n];if(!p.every(F=>F.status===2)){l.forEach((F,u)=>F.status=p[u].status);break}}n<0&&l.forEach(p=>p.status=0)}}R.value+=c*c*100,x.value+=c};os(()=>{window.addEventListener("keydown",z),window.addEventListener("keyup",N)}),es(()=>{window.removeEventListener("keydown",z),window.removeEventListener("keyup",N),clearTimeout(L)});const z=s=>{s.preventDefault();const n=s.keyCode;g.value===2&&(n<37||n>40||[()=>I(-1),Q,()=>I(1),()=>O&&T()][n-37]())},N=s=>O=!0,I=s=>{const n=e.value+s;S(r.value,a.value,n)||(i(r.value,a.value,e.value,0),e.value+=s,i(r.value,a.value,e.value,1))},Q=()=>{const s=P(r.value);let n=e.value+s[0].length-1;n=n>=f?f-s[0].length:e.value,!S(s,a.value,n)&&(i(r.value,a.value,e.value,0),r.value=s,e.value=n,i(r.value,a.value,e.value,1))};return{ROW:q,COL:f,grids:m,nextBlock:k,gameStatus:g,score:R,startGame:J}}});const Ds={class:"tetris flex-horiz flex-center-all"},Cs={class:"flex-horiz container pos-r"},As={class:"font-bold",style:{"font-size":"20px"}},is={class:"game-container pos-r"},us={class:"grid-row flex-horiz"},bs={class:"candidate-container ml-sm",style:{width:"100px"}},ms={class:"mb-xs"},vs={style:{"font-size":"26px"}},ds={class:"mb-xs mt-md"},gs={key:0,class:"game-container disp-ib"},fs={class:"grid-row flex-horiz"};function Es(o,y,D,m,g,P){const i=V("start-over-mask"),E=V("n-tag");return C(),A("div",Ds,[d("div",Cs,[w(i,{status:o.gameStatus,onOnClickStart:o.startGame},{default:j(()=>[d("span",As,G(o.score)+" \u5206",1)]),_:1},8,["status","onOnClickStart"]),d("div",is,[(C(!0),A(_,null,B(o.grids,v=>(C(),A("div",us,[(C(!0),A(_,null,B(v,a=>(C(),A("div",{class:U(["grid border-box",a.status!==0?"active":""])},null,2))),256))]))),256))]),d("div",bs,[d("div",ms,[w(E,null,{default:j(()=>[W("SCORE")]),_:1})]),d("div",vs,G(o.score),1),d("div",ds,[w(E,null,{default:j(()=>[W("NEXT")]),_:1})]),o.nextBlock?(C(),A("div",gs,[(C(!0),A(_,null,B(o.nextBlock,v=>(C(),A("div",fs,[(C(!0),A(_,null,B(v,a=>(C(),A("div",{class:U(["grid border-box",a?"active":""])},null,2))),256))]))),256))])):cs("",!0)])])])}const ks=rs(ys,[["render",Es],["__scopeId","data-v-185657fd"]]),hs=$("",4),_s=$("",8),Os=JSON.parse('{"title":"\u4FC4\u7F57\u65AF\u65B9\u5757","description":"","frontmatter":{"outline":"deep"},"headers":[{"level":2,"title":"\u73A9\u6CD5","slug":"\u73A9\u6CD5","link":"#\u73A9\u6CD5","children":[]},{"level":2,"title":"\u7B97\u6CD5","slug":"\u7B97\u6CD5","link":"#\u7B97\u6CD5","children":[]},{"level":2,"title":"\u6E90\u7801","slug":"\u6E90\u7801","link":"#\u6E90\u7801","children":[]}],"relativePath":"games/tetris.md"}'),Bs={name:"games/tetris.md"},Ss=Object.assign(Bs,{setup(o){return(y,D)=>(C(),A("div",null,[hs,w(ks),_s]))}});export{Os as __pageData,Ss as default};
