var x=Object.defineProperty;var f=(n,s,a)=>s in n?x(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a;var c=(n,s,a)=>(f(n,typeof s!="symbol"?s+"":s,a),a);import"./chunks/lodash.4dce4bbd.js";import{_ as g,o as b,c as h,k as C,e as v,C as W,H as u,w,Q as m}from"./chunks/framework.c98d58aa.js";import"./chunks/commonjsHelpers.de833af9.js";const p=Math,i=Math.PI,r=class r{constructor(s,a){c(this,"x1",0);c(this,"y1",0);c(this,"x2",0);c(this,"y2",0);c(this,"show",!0);this.x1=s,this.y1=a,this.x2=s+r.w,this.y2=a+r.h}};c(r,"w",50),c(r,"h",20),c(r,"row",7),c(r,"column",6);let e=r;const T={name:"ArknoidGame",data(){return{step:2,gameTime:0,remainTile:0,runTmo:null,ctx:null,lineWall:{w:100,h:10,x:0,y:450,last:[]},canvas:{w:800,h:480},ball:{r:3,x:100,y:100,dir:[p.cos(i/4),-p.sin(i/4)]},tiles:[],status:0}},mounted(){this.ctx=this.$refs.canvas.getContext("2d"),this.resetStatus()},beforeDestroy(){clearTimeout(this.runTmo)},methods:{restart(){this.status=1,this.resetStatus(),this.runtime()},resetStatus(){this.lineWall.x=(this.canvas.w-this.lineWall.w)/2,this.ball.x=this.lineWall.x+this.lineWall.w/2,this.ball.y=this.canvas.h-40,this.ball.dir=[p.cos(i/4)*this.step,-p.sin(i/4)*this.step],this.remainTile=e.row*e.column*2,this.resetTiles(),this.renderTiles(),this.renderLineWall(),this.renderBall()},gameOver(){this.status=0,clearTimeout(this.runTmo)},runtime(){this.ctx.clearRect(0,0,this.$refs.canvas.offsetWidth,this.$refs.canvas.offsetHeight),this.computeCrashWall()||this.computeCrashLineWall()||this.computeCrashTiles(),this.renderLineWall(),this.renderTiles(),this.renderBall(),this.status&&(this.runTmo=setTimeout(this.runtime.bind(this),1))},computeCrashWall(){return this.ball.x+this.ball.r>=this.canvas.w?(this.ball.dir[0]=-p.abs(this.ball.dir[0]),!1):this.ball.x<=0?(this.ball.dir[0]=p.abs(this.ball.dir[0]),!1):this.ball.y<=0?(this.ball.dir[1]=p.abs(this.ball.dir[1]),!1):(this.ball.y>this.canvas.h&&this.gameOver(),!1)},computeCrashTiles(){const n=this.ball.x-this.ball.r,s=this.ball.x+this.ball.r,a=this.ball.y-this.ball.r,l=this.ball.y+this.ball.r,t=[this.ball.dir[0]>=0?1:0,this.ball.dir[1]>=0?1:0],o=[t[0]?s:n,t[1]?l:a],E=e.column*(e.w+1),A=e.row*(e.h+1);if(o[1]<50||o[1]>50+A||o[0]<50||o[0]>450+E||o[0]<450&&o[0]>50+E)return!1;const D=p.floor((o[1]-50)/(e.h+1)),B=o[0]>400?1:0,d=p.floor((o[0]-(B?400:0)-50)/(e.w+1)),y=this.tiles[B][D][d];if(!y.show)return!1;const F=[t[0]?o[0]-y.x1:y.x2-o[0],t[1]?o[1]-y.y1:y.y2-o[1]];F[0]<0||F[1]<F[0]?this.ball.dir[1]=-this.ball.dir[1]:this.ball.dir[0]=-this.ball.dir[0],y.show=!1,--this.remainTile<=0&&this.gameOver()},computeCrashLineWall(){if(this.ball.dir[1]>=0&&this.ball.y+this.ball.r>=this.lineWall.y&&this.ball.x+this.ball.r>this.lineWall.x&&this.ball.x-this.ball.r<this.lineWall.x+this.lineWall.w){const n=(this.ball.x-this.lineWall.x-this.lineWall.w/2)/100,s=p.abs(p.max(p.min(n,.5),-.5)),a=p.abs(p.atan(this.ball.dir[1]/this.ball.dir[0]));if(this.ball.dir[0]>=0){const l=n>0?a-a*s:a+(i-a)*s;this.ball.dir[0]=p.cos(l)*this.step,this.ball.dir[1]=-p.abs(p.sin(l))*this.step}else{const l=n>0?a+(i-a)*s:a-a*s;this.ball.dir[0]=-p.cos(l)*this.step,this.ball.dir[1]=-p.abs(p.sin(l))*this.step}return!0}return!1},onMouseMove(n){this.lineWall.x=n.offsetX-this.lineWall.w/2},resetTiles(){for(let n=0;n<2;n++){const s=n*400+50,a=50;this.tiles[n]=[];for(let l=0;l<e.row;l++){this.tiles[n][l]=[];for(let t=0;t<6;t++)this.tiles[n][l][t]=new e(t*(e.w+1)+s,l*(e.h+1)+a)}}},renderTiles(){this.ctx.fillStyle="#001f3f";for(let n=0;n<this.tiles.length;n++)for(let s=0;s<this.tiles[n].length;s++)for(let a=0;a<this.tiles[n][s].length;a++){const l=this.tiles[n][s][a];l.show&&this.ctx.fillRect(l.x1,l.y1,e.w,e.h)}},renderBall(){this.ctx.fillStyle="#FF851B ",this.ctx.beginPath(),this.ball.x+=this.ball.dir[0],this.ball.y+=this.ball.dir[1],this.ctx.arc(this.ball.x,this.ball.y,this.ball.r,0,2*Math.PI),this.ctx.fill()},renderLineWall(){const n=this.canvas.w-this.lineWall.w;let s=this.lineWall.x;s>n&&(s=n),s<0&&(s=0),this.lineWall.last.push(this.lineWall.x),this.lineWall.last.length>10&&this.lineWall.last.shift(),this.ctx.fillStyle="#0a0a76",this.ctx.fillRect(s,this.lineWall.y,this.lineWall.w,this.lineWall.h)}}},q={class:"ArknoidGame flex-column flex-center-all"},M={class:"pos-r",style:{height:"480px",width:"800px"}},_={key:0,class:"pos-a",style:{top:"150px","z-index":"2",left:"0",right:"0"}};function k(n,s,a,l,t,o){return b(),h("div",q,[C("div",M,[C("canvas",{class:"canvas",width:"800",height:"480",ref:"canvas",onMousemove:s[0]||(s[0]=(...E)=>o.onMouseMove&&o.onMouseMove(...E))},null,544),t.status?v("",!0):(b(),h("div",_,[C("div",{class:"color-text fz-lg cursor-p ptb-sm font-bold bg-white text-center",style:{width:"130px",margin:"auto",border:"5px solid #cccccc"},onClick:s[1]||(s[1]=(...E)=>o.restart&&o.restart(...E))}," 点击开始 ")]))])])}const P=g(T,[["render",k],["__scopeId","data-v-aed34944"]]),I=m("",4),S=m("",9),G=JSON.parse('{"title":"打砖块","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"games/arknoid.md","filePath":"games/arknoid.md"}'),j={name:"games/arknoid.md"},$=Object.assign(j,{setup(n){return(s,a)=>{const l=W("ClientOnly");return b(),h("div",null,[I,u(l,null,{default:w(()=>[u(P)]),_:1}),S])}}});export{G as __pageData,$ as default};
