import{_ as K}from"./chunks/lodash.aK6H4lhT.js";import{a as H}from"./chunks/array.util.DVdZD237.js";import{g as Y}from"./chunks/number.util.Cpjkx7EM.js";import{S as Z}from"./chunks/start-over-mask.DM_cgGdI.js";import{e as ss,r as c,c as is,o as as,C as ns,a0 as ls,h as j,n as E,k as r,m as u,t as A,l as w,A as G,F as f,Q as _,s as V,p as ks,z as U,R as W}from"./chunks/framework.BULi5HC7.js";import"./chunks/theme.HcMMCyBp.js";const q=20,m=10;class hs{constructor(D,C){this.status=0,this.row=D,this.col=C}}const ps=[[[1,1,0],[0,1,1]],[[1,1,1,1]],[[1,1,1],[0,0,1]],[[1,1,1],[1,0,0]],[[1]],[[1,1],[0,1]],[[1,1],[1,0]],[[1,1],[1,1]],[[1,1,1],[0,1,0]]],ts=ss({name:"tetris",components:{StartOverMask:Z},props:{},setup(d,D){const C=()=>new Array(q).fill(null).map((s,i)=>new Array(m).fill(null).map((p,n)=>new hs(i,n))),g=c(C()),o=c(0),P=(s,i=1)=>{let p=K.cloneDeep(s),n;for(;i-- >0;){const t=p.length,l=p[0].length;n=[];for(let e=0;e<l;e++){n[e]=[];for(let F=0;F<t;F++)n[e][F]=p[t-F-1][e]}p=K.cloneDeep(n)}return n||p},y=(s,i,p,n=1)=>{for(let t=0;t<s.length;t++)for(let l=0;l<s[0].length;l++){const[e,F]=[t+i,l+p],M=g.value[e][F];M.status!==2&&(M.status=s[t][l]?n:M.status)}},B=s=>Math.floor((m-s[0].length)/2),b=()=>P(H(ps,1)[0],Y(0,3)),a=c(0),k=c(0),h=c(null),v=c(null),R=c(0),x=c(0),$=is(()=>{const s=x.value/20;return Math.floor(1500/(s<1?1:s))});let O=null,L=!0;const S=(s,i,p)=>{for(let n=0;n<s.length;n++)for(let t=0;t<s[0].length;t++){const[l,e]=[n+i,t+p];if(l<0||l>=q||e<0||e>=m||s[n][t]&&g.value[l][e].status===2)return!0}return!1},X=()=>{R.value=0,x.value=0,g.value=C(),h.value=b(),v.value=b(),o.value=2,a.value=-1,k.value=B(h.value),T()},T=()=>{if(clearTimeout(O),o.value===2){if(a.value>=0&&y(h.value,a.value,k.value,0),a.value++,S(h.value,a.value,k.value)){if(y(h.value,a.value-1,k.value,2),a.value<=1)return o.value=3;h.value=v.value,v.value=b(),a.value=0,k.value=B(h.value),J(),L=!1}y(h.value,a.value,k.value,1),O=setTimeout(T,$.value)}},J=()=>{let s=q,i=s,p=0;for(;--s>=0;){const n=g.value[s],t=n.every(l=>l.status===2);if(t&&p++,!(!t&&i>s)){for(i=i>s?s:i;--i>=0;){const l=g.value[i];if(!l.every(e=>e.status===2)){n.forEach((e,F)=>e.status=l[F].status);break}}i<0&&n.forEach(l=>l.status=0)}}R.value+=p*p*100,x.value+=p};as(()=>{window.addEventListener("keydown",z),window.addEventListener("keyup",N)}),ns(()=>{window.removeEventListener("keydown",z),window.removeEventListener("keyup",N),clearTimeout(O)});const z=s=>{s.preventDefault();const i=s.keyCode;o.value===2&&(i<37||i>40||[()=>I(-1),Q,()=>I(1),()=>L&&T()][i-37]())},N=s=>L=!0,I=s=>{const i=k.value+s;S(h.value,a.value,i)||(y(h.value,a.value,k.value,0),k.value+=s,y(h.value,a.value,k.value,1))},Q=()=>{const s=P(h.value);let i=k.value+s[0].length-1;i=i>=m?m-s[0].length:k.value,!S(s,a.value,i)&&(y(h.value,a.value,k.value,0),h.value=s,k.value=i,y(h.value,a.value,k.value,1))};return{ROW:q,COL:m,grids:g,nextBlock:v,gameStatus:o,score:R,startGame:X}}}),es={class:"tetris flex-horiz flex-center-all"},Es={class:"flex-horiz container pos-r"},rs={class:"font-bold",style:{"font-size":"20px"}},ds={class:"game-container pos-r"},gs={class:"grid-row flex-horiz"},ys={class:"candidate-container ml-sm",style:{width:"100px"}},Fs={class:"mb-xs"},cs={style:{"font-size":"26px"}},bs={class:"mb-xs mt-md"},us={key:0,class:"game-container disp-ib"},Cs={class:"grid-row flex-horiz"};function os(d,D,C,g,o,P){const y=j("start-over-mask"),B=j("a-tag");return r(),E("div",es,[u("div",Es,[A(y,{status:d.gameStatus,onOnClickStart:d.startGame},{default:w(()=>[u("span",rs,G(d.score)+" 分",1)]),_:1},8,["status","onOnClickStart"]),u("div",ds,[(r(!0),E(f,null,_(d.grids,b=>(r(),E("div",gs,[(r(!0),E(f,null,_(b,a=>(r(),E("div",{class:V(["grid border-box",a.status!==0?"active":""])},null,2))),256))]))),256))]),u("div",ys,[u("div",Fs,[A(B,null,{default:w(()=>[U("SCORE")]),_:1})]),u("div",cs,G(d.score),1),u("div",bs,[A(B,null,{default:w(()=>[U("NEXT")]),_:1})]),d.nextBlock?(r(),E("div",us,[(r(!0),E(f,null,_(d.nextBlock,b=>(r(),E("div",Cs,[(r(!0),E(f,null,_(b,a=>(r(),E("div",{class:V(["grid border-box",a?"active":""])},null,2))),256))]))),256))])):ks("",!0)])])])}const ms=ls(ts,[["render",os],["__scopeId","data-v-c20b52f6"]]),Bs=W("",4),As=W("",8),Rs=JSON.parse('{"title":"俄罗斯方块","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"games/tetris.md","filePath":"games/tetris.md"}'),Ds={name:"games/tetris.md"},xs=Object.assign(Ds,{setup(d){return(D,C)=>{const g=j("ClientOnly");return r(),E("div",null,[Bs,A(g,null,{default:w(()=>[A(ms)]),_:1}),As])}}});export{Rs as __pageData,xs as default};
