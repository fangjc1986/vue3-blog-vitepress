import{_ as G}from"./chunks/lodash.4dce4bbd.js";import{a as Q}from"./chunks/array.util.aa365c9a.js";import{g as Y}from"./chunks/number.util.14bcf861.js";import{S as Z}from"./chunks/start-over-mask.13ccb049.js";import{d as ss,h as C,g as ns,j as as,a1 as ls,_ as ps,C as T,o as E,c as y,k as B,H as d,w as P,t as I,F as h,D as q,n as W,a as U,e as os,Q as V}from"./chunks/framework.aa4ce59a.js";import"./chunks/commonjsHelpers.de833af9.js";const w=20,D=10;class es{constructor(k,A){this.status=0,this.row=k,this.col=A}}const cs=[[[1,1,0],[0,1,1]],[[1,1,1,1]],[[1,1,1],[0,0,1]],[[1,1,1],[1,0,0]],[[1]],[[1,1],[0,1]],[[1,1],[1,0]],[[1,1],[1,1]],[[1,1,1],[0,1,0]]],rs=ss({name:"tetris",components:{StartOverMask:Z},props:{},setup(i,k){const A=()=>new Array(w).fill(null).map((s,n)=>new Array(D).fill(null).map((c,l)=>new es(n,l))),F=C(A()),g=C(0),_=(s,n=1)=>{let c=G.cloneDeep(s),l;for(;n-- >0;){const r=c.length,p=c[0].length;l=[];for(let t=0;t<p;t++){l[t]=[];for(let b=0;b<r;b++)l[t][b]=c[r-b-1][t]}c=G.cloneDeep(l)}return l||c},u=(s,n,c,l=1)=>{for(let r=0;r<s.length;r++)for(let p=0;p<s[0].length;p++){const[t,b]=[r+n,p+c],j=F.value[t][b];j.status!==2&&(j.status=s[r][p]?l:j.status)}},v=s=>Math.floor((D-s[0].length)/2),m=()=>_(Q(cs,1)[0],Y(0,3)),a=C(0),o=C(0),e=C(null),f=C(null),R=C(0),x=C(0),$=ns(()=>{const s=x.value/20;return Math.floor(1500/(s<1?1:s))});let L=null,O=!0;const S=(s,n,c)=>{for(let l=0;l<s.length;l++)for(let r=0;r<s[0].length;r++){const[p,t]=[l+n,r+c];if(p<0||p>=w||t<0||t>=D||s[l][r]&&F.value[p][t].status===2)return!0}return!1},X=()=>{R.value=0,x.value=0,F.value=A(),e.value=m(),f.value=m(),g.value=2,a.value=-1,o.value=v(e.value),M()},M=()=>{if(clearTimeout(L),g.value===2){if(a.value>=0&&u(e.value,a.value,o.value,0),a.value++,S(e.value,a.value,o.value)){if(u(e.value,a.value-1,o.value,2),a.value<=1)return g.value=3;e.value=f.value,f.value=m(),a.value=0,o.value=v(e.value),H(),O=!1}u(e.value,a.value,o.value,1),L=setTimeout(M,$.value)}},H=()=>{let s=w,n=s,c=0;for(;--s>=0;){const l=F.value[s],r=l.every(p=>p.status===2);if(r&&c++,!(!r&&n>s)){for(n=n>s?s:n;--n>=0;){const p=F.value[n];if(!p.every(t=>t.status===2)){l.forEach((t,b)=>t.status=p[b].status);break}}n<0&&l.forEach(p=>p.status=0)}}R.value+=c*c*100,x.value+=c};as(()=>{window.addEventListener("keydown",z),window.addEventListener("keyup",K)}),ls(()=>{window.removeEventListener("keydown",z),window.removeEventListener("keyup",K),clearTimeout(L)});const z=s=>{s.preventDefault();const n=s.keyCode;g.value===2&&(n<37||n>40||[()=>N(-1),J,()=>N(1),()=>O&&M()][n-37]())},K=s=>O=!0,N=s=>{const n=o.value+s;S(e.value,a.value,n)||(u(e.value,a.value,o.value,0),o.value+=s,u(e.value,a.value,o.value,1))},J=()=>{const s=_(e.value);let n=o.value+s[0].length-1;n=n>=D?D-s[0].length:o.value,!S(s,a.value,n)&&(u(e.value,a.value,o.value,0),e.value=s,o.value=n,u(e.value,a.value,o.value,1))};return{ROW:w,COL:D,grids:F,nextBlock:f,gameStatus:g,score:R,startGame:X}}});const ts={class:"tetris flex-horiz flex-center-all"},Es={class:"flex-horiz container pos-r"},ys={class:"font-bold",style:{"font-size":"20px"}},is={class:"game-container pos-r"},Fs={class:"grid-row flex-horiz"},us={class:"candidate-container ml-sm",style:{width:"100px"}},bs={class:"mb-xs"},Cs={style:{"font-size":"26px"}},ms={class:"mb-xs mt-md"},Bs={key:0,class:"game-container disp-ib"},As={class:"grid-row flex-horiz"};function gs(i,k,A,F,g,_){const u=T("start-over-mask"),v=T("a-tag");return E(),y("div",ts,[B("div",Es,[d(u,{status:i.gameStatus,onOnClickStart:i.startGame},{default:P(()=>[B("span",ys,I(i.score)+" 分",1)]),_:1},8,["status","onOnClickStart"]),B("div",is,[(E(!0),y(h,null,q(i.grids,m=>(E(),y("div",Fs,[(E(!0),y(h,null,q(m,a=>(E(),y("div",{class:W(["grid border-box",a.status!==0?"active":""])},null,2))),256))]))),256))]),B("div",us,[B("div",bs,[d(v,null,{default:P(()=>[U("SCORE")]),_:1})]),B("div",Cs,I(i.score),1),B("div",ms,[d(v,null,{default:P(()=>[U("NEXT")]),_:1})]),i.nextBlock?(E(),y("div",Bs,[(E(!0),y(h,null,q(i.nextBlock,m=>(E(),y("div",As,[(E(!0),y(h,null,q(m,a=>(E(),y("div",{class:W(["grid border-box",a?"active":""])},null,2))),256))]))),256))])):os("",!0)])])])}const Ds=ps(rs,[["render",gs],["__scopeId","data-v-c20b52f6"]]),vs=V("",4),ds=V("",8),Rs=JSON.parse('{"title":"俄罗斯方块","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"games/tetris.md","filePath":"games/tetris.md"}'),ks={name:"games/tetris.md"},xs=Object.assign(ks,{setup(i){return(k,A)=>{const F=T("ClientOnly");return E(),y("div",null,[vs,d(F,null,{default:P(()=>[d(Ds)]),_:1}),ds])}}});export{Rs as __pageData,xs as default};
