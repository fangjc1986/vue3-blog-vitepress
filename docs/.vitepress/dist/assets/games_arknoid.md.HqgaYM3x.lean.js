var m=Object.defineProperty;var o=(i,s,a)=>s in i?m(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a;var t=(i,s,a)=>o(i,typeof s!="symbol"?s+"":s,a);import"./chunks/lodash.aK6H4lhT.js";import{a0 as x,n as F,k as C,m as y,p as f,h as v,R as B,t as b,l as W}from"./chunks/framework.BULi5HC7.js";import"./chunks/theme.HcMMCyBp.js";const h=Math,d=Math.PI,e=class e{constructor(s,a){t(this,"x1",0);t(this,"y1",0);t(this,"x2",0);t(this,"y2",0);t(this,"show",!0);this.x1=s,this.y1=a,this.x2=s+e.w,this.y2=a+e.h}};t(e,"w",50),t(e,"h",20),t(e,"row",7),t(e,"column",6);let k=e;const w={name:"ArknoidGame",data(){return{step:2,gameTime:0,remainTile:0,runTmo:null,ctx:null,lineWall:{w:100,h:10,x:0,y:450,last:[]},canvas:{w:800,h:480},ball:{r:3,x:100,y:100,dir:[h.cos(d/4),-h.sin(d/4)]},tiles:[],status:0}},mounted(){this.ctx=this.$refs.canvas.getContext("2d"),this.resetStatus()},beforeDestroy(){clearTimeout(this.runTmo)},methods:{restart(){this.status=1,this.resetStatus(),this.runtime()},resetStatus(){this.lineWall.x=(this.canvas.w-this.lineWall.w)/2,this.ball.x=this.lineWall.x+this.lineWall.w/2,this.ball.y=this.canvas.h-40,this.ball.dir=[h.cos(d/4)*this.step,-h.sin(d/4)*this.step],this.remainTile=k.row*k.column*2,this.resetTiles(),this.renderTiles(),this.renderLineWall(),this.renderBall()},gameOver(){this.status=0,clearTimeout(this.runTmo)},runtime(){this.ctx.clearRect(0,0,this.$refs.canvas.offsetWidth,this.$refs.canvas.offsetHeight),this.computeCrashWall()||this.computeCrashLineWall()||this.computeCrashTiles(),this.renderLineWall(),this.renderTiles(),this.renderBall(),this.status&&(this.runTmo=setTimeout(this.runtime.bind(this),1))},computeCrashWall(){return this.ball.x+this.ball.r>=this.canvas.w?(this.ball.dir[0]=-h.abs(this.ball.dir[0]),!1):this.ball.x<=0?(this.ball.dir[0]=h.abs(this.ball.dir[0]),!1):this.ball.y<=0?(this.ball.dir[1]=h.abs(this.ball.dir[1]),!1):(this.ball.y>this.canvas.h&&this.gameOver(),!1)},computeCrashTiles(){const i=this.ball.x-this.ball.r,s=this.ball.x+this.ball.r,a=this.ball.y-this.ball.r,n=this.ball.y+this.ball.r,p=[this.ball.dir[0]>=0?1:0,this.ball.dir[1]>=0?1:0],l=[p[0]?s:i,p[1]?n:a],E=k.column*(k.w+1),u=k.row*(k.h+1);if(l[1]<50||l[1]>50+u||l[0]<50||l[0]>450+E||l[0]<450&&l[0]>50+E)return!1;const A=h.floor((l[1]-50)/(k.h+1)),c=l[0]>400?1:0,D=h.floor((l[0]-(c?400:0)-50)/(k.w+1)),r=this.tiles[c][A][D];if(!r.show)return!1;const g=[p[0]?l[0]-r.x1:r.x2-l[0],p[1]?l[1]-r.y1:r.y2-l[1]];g[0]<0||g[1]<g[0]?this.ball.dir[1]=-this.ball.dir[1]:this.ball.dir[0]=-this.ball.dir[0],r.show=!1,--this.remainTile<=0&&this.gameOver()},computeCrashLineWall(){if(this.ball.dir[1]>=0&&this.ball.y+this.ball.r>=this.lineWall.y&&this.ball.x+this.ball.r>this.lineWall.x&&this.ball.x-this.ball.r<this.lineWall.x+this.lineWall.w){const i=(this.ball.x-this.lineWall.x-this.lineWall.w/2)/100,s=h.abs(h.max(h.min(i,.5),-.5)),a=h.abs(h.atan(this.ball.dir[1]/this.ball.dir[0]));if(this.ball.dir[0]>=0){const n=i>0?a-a*s:a+(d-a)*s;this.ball.dir[0]=h.cos(n)*this.step,this.ball.dir[1]=-h.abs(h.sin(n))*this.step}else{const n=i>0?a+(d-a)*s:a-a*s;this.ball.dir[0]=-h.cos(n)*this.step,this.ball.dir[1]=-h.abs(h.sin(n))*this.step}return!0}return!1},onMouseMove(i){this.lineWall.x=i.offsetX-this.lineWall.w/2},resetTiles(){for(let i=0;i<2;i++){const s=i*400+50,a=50;this.tiles[i]=[];for(let n=0;n<k.row;n++){this.tiles[i][n]=[];for(let p=0;p<6;p++)this.tiles[i][n][p]=new k(p*(k.w+1)+s,n*(k.h+1)+a)}}},renderTiles(){this.ctx.fillStyle="#001f3f";for(let i=0;i<this.tiles.length;i++)for(let s=0;s<this.tiles[i].length;s++)for(let a=0;a<this.tiles[i][s].length;a++){const n=this.tiles[i][s][a];n.show&&this.ctx.fillRect(n.x1,n.y1,k.w,k.h)}},renderBall(){this.ctx.fillStyle="#FF851B ",this.ctx.beginPath(),this.ball.x+=this.ball.dir[0],this.ball.y+=this.ball.dir[1],this.ctx.arc(this.ball.x,this.ball.y,this.ball.r,0,2*Math.PI),this.ctx.fill()},renderLineWall(){const i=this.canvas.w-this.lineWall.w;let s=this.lineWall.x;s>i&&(s=i),s<0&&(s=0),this.lineWall.last.push(this.lineWall.x),this.lineWall.last.length>10&&this.lineWall.last.shift(),this.ctx.fillStyle="#0a0a76",this.ctx.fillRect(s,this.lineWall.y,this.lineWall.w,this.lineWall.h)}}},T={class:"ArknoidGame flex-column flex-center-all"},q={class:"pos-r",style:{height:"480px",width:"800px"}},M={key:0,class:"pos-a",style:{top:"150px","z-index":"2",left:"0",right:"0"}};function _(i,s,a,n,p,l){return C(),F("div",T,[y("div",q,[y("canvas",{class:"canvas",width:"800",height:"480",ref:"canvas",onMousemove:s[0]||(s[0]=(...E)=>l.onMouseMove&&l.onMouseMove(...E))},null,544),p.status?f("",!0):(C(),F("div",M,[y("div",{class:"color-text fz-lg cursor-p ptb-sm font-bold bg-white text-center",style:{width:"130px",margin:"auto",border:"5px solid #cccccc"},onClick:s[1]||(s[1]=(...E)=>l.restart&&l.restart(...E))}," 点击开始 ")]))])])}const P=x(w,[["render",_],["__scopeId","data-v-aed34944"]]),S=B("",4),I=B("",9),H=JSON.parse('{"title":"打砖块","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"games/arknoid.md","filePath":"games/arknoid.md"}'),j={name:"games/arknoid.md"},N=Object.assign(j,{setup(i){return(s,a)=>{const n=v("ClientOnly");return C(),F("div",null,[S,b(n,null,{default:W(()=>[b(P)]),_:1}),I])}}});export{H as __pageData,N as default};
